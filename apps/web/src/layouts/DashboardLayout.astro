---
import BaseLayout from './BaseLayout.astro';
import { LayoutDashboard, FolderKanban, Users, FileText, CircleHelp, Settings, Search, Bell } from 'lucide-react';
import HeaderUser from '@/components/HeaderUser';
import SidebarLogout from '@/components/SidebarLogout';
import MobileSidebar from '@/components/MobileSidebar';
import NotificationBell from '@/components/Admin/NotificationBell';

interface Props {
	title: string;
}

const { title } = Astro.props;
const currentPath = Astro.url.pathname;

// Helper for active-link styling
const linkClass = (href: string) => {
	const isActive = currentPath === href || currentPath.startsWith(href + '/');
	return isActive
		? 'flex items-center gap-3 px-4 py-3 text-sm font-medium text-white bg-brand-primary/10 border border-brand-primary/20 rounded-lg transition-all'
		: 'flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 rounded-lg transition-all';
};
---

<BaseLayout title={title}>
	<div class="flex h-screen bg-dark-bg">
		<!-- Desktop Sidebar (hidden on mobile) -->
		<aside class="hidden md:flex w-64 border-r border-white/5 flex-col bg-dark-bg/50 backdrop-blur-xl shrink-0">
			<div class="px-6 py-8">
				<a href="/dashboard" class="block">
					<img 
						src="/logo-completo.webp" 
						alt="EDIFICIA" 
						class="h-10 w-auto object-contain"
					/>
				</a>
			</div>

			<nav class="flex-1 px-4 space-y-2 mt-4">
				<a href="/dashboard" class={linkClass('/dashboard')}>
					<LayoutDashboard size={18} className={currentPath === '/dashboard' ? 'text-brand-primary' : ''} />
					Inicio
				</a>
				<a href="/admin/projects" class={linkClass('/admin/projects')}>
					<FolderKanban size={18} className={currentPath.startsWith('/admin/projects') ? 'text-brand-primary' : ''} />
					Proyectos
				</a>
				<a href="/admin/users" class={linkClass('/admin/users')}>
					<Users size={18} className={currentPath.startsWith('/admin/users') ? 'text-brand-primary' : ''} />
					Usuarios
				</a>
				<a href="/admin/templates" class={linkClass('/admin/templates')}>
					<FileText size={18} className={currentPath.startsWith('/admin/templates') ? 'text-brand-primary' : ''} />
					Plantillas
				</a>
				<a href="/ayuda" class={linkClass('/ayuda')}>
					<CircleHelp size={18} className={currentPath.startsWith('/ayuda') ? 'text-brand-primary' : ''} />
					Ayuda
				</a>
			</nav>

			<div class="p-4 border-t border-white/5 space-y-2">
				<span class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-500 cursor-not-allowed rounded-lg opacity-50" title="PrÃ³ximamente">
					<Settings size={18} />
					Ajustes
				</span>
				<SidebarLogout client:load />
			</div>
		</aside>

		<!-- Main Content -->
		<div class="flex-1 flex flex-col overflow-hidden min-w-0">
			<!-- Header -->
			<header class="h-16 border-b border-white/5 flex items-center justify-between px-4 md:px-8 bg-dark-bg/30 backdrop-blur-md shrink-0">
				<div class="flex items-center gap-3 flex-1">
					<!-- Mobile hamburger + sidebar -->
					<MobileSidebar client:load />

					<!-- Search (hidden on very small screens) -->
					<div class="hidden sm:block relative flex-1 max-w-xl">
						<Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500" size={16} />
						<input 
							type="text" 
							placeholder="Buscar proyectos..." 
							class="w-full bg-white/5 border border-white/10 rounded-full py-2 pl-10 pr-4 text-sm focus:outline-none focus:ring-1 focus:ring-brand-primary transition-all"
						/>
					</div>
				</div>

				<div class="flex items-center gap-2 md:gap-4">
					<NotificationBell client:load />
					<HeaderUser client:load />
				</div>

			</header>

			<!-- Scrollable Area -->
			<main class="flex-1 overflow-y-auto p-4 md:p-8">
				<slot />
			</main>
		</div>
	</div>
</BaseLayout>
